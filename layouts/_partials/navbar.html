{{- $navWidth := "hx:max-w-[90rem]" -}}
{{- with .Site.Params.navbar.width -}}
  {{ if eq . "normal" -}}
    {{ $navWidth = "hx:max-w-screen-xl" -}}
  {{ else if eq . "full" -}}
    {{ $navWidth = "max-w-full" -}}
  {{ end -}}
{{- end -}}

{{- $page := . -}}
{{- $iconHeight := 24 -}}
{{- $relPermalink := .RelPermalink | default "" -}}
{{- $isDocsPage := or (eq .Section "docs") (strings.HasPrefix $relPermalink "/docs/") -}}
{{- if $isDocsPage -}}
  {{- .Store.Set "hasDocWidthToggle" true -}}
{{- end -}}

<div class="hextra-nav-container hx:sticky hx:top-0 hx:z-20 hx:w-full hx:bg-transparent hx:print:hidden">
  <div
    class="hextra-nav-container-blur hx:pointer-events-none hx:absolute hx:z-[-1] hx:h-full hx:w-full hx:bg-white hx:dark:bg-dark hx:shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] hx:contrast-more:shadow-[0_0_0_1px_#000] hx:dark:shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] hx:contrast-more:dark:shadow-[0_0_0_1px_#fff]"
  ></div>

  <nav class="hextra-max-navbar-width hx:mx-auto hx:flex hx:items-center hx:justify-end hx:gap-2 hx:h-16 hx:px-6">
    {{ partial "navbar-title.html" . }}

    {{- $currentPage := . -}}
    {{- range .Site.Menus.main -}}
      {{- if eq .Params.type "search" -}}
        {{- partial "search.html" (dict "params" .Params) -}}
      {{- else -}}
        {{- $link := .URL -}}
        {{- $external := strings.HasPrefix $link "http" -}}
        {{- with .PageRef -}}
          {{- if hasPrefix . "/" -}}
            {{- $link = relLangURL (strings.TrimPrefix "/" .) -}}
          {{- end -}}
        {{- end -}}

        {{- if eq .Params.type "link" -}}
          {{- partial "navbar-link.html" (dict "currentPage" $currentPage "link" $link "external" $external "item" . "icon" .Params.icon) -}}
        {{- else if eq .Params.type "theme-toggle" -}}
          {{- partial "theme-toggle.html" (dict "iconHeight" $iconHeight "hideLabel" (not .Params.label) "iconHeight" $iconHeight "location" "top" "class" "hx:p-2") -}}
        {{- else if eq .Params.type "language-switch" -}}
          {{- partial "language-switch" (dict "context" $page "grow" false "hideLabel" (not .Params.label) "iconName" (.Params.icon | default "translate") "iconHeight" $iconHeight "location" "top" "class" "hx:p-2") -}}
        {{- else if .Params.icon -}}
          {{- /* Display icon menu item */ -}}
          {{- if not $link -}}{{ warnf "Icon menu item '%s' has no URL" .Name }}{{- end -}}
          {{- $rel := cond (eq .Params.icon "mastodon") "noreferrer me" "noreferrer" }}
          <a class="hx:p-2 hx:text-current" {{ if $external }}target="_blank" rel="{{ $rel }}"{{ end }} href="{{ $link }}" title="{{ or (T .Identifier) .Name | safeHTML }}">
            {{- partial "utils/icon.html" (dict "name" .Params.icon "attributes" (printf "height=%d" $iconHeight)) -}}
            <span class="hx:sr-only">{{ or (T .Identifier) .Name | safeHTML }}</span>
          </a>
        {{- else -}}
          {{- partial "navbar-link.html" (dict "currentPage" $currentPage "link" $link "external" $external "item" .) -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{- if $isDocsPage }}
      <button
        id="doc-width-toggle"
        type="button"
        class="hx:p-2 hx:text-current hx:rounded-md hx:transition-colors hx:duration-150 hx:ease-in-out hx:hover:text-gray-900 hx:dark:text-gray-300 hx:dark:hover:text-gray-100 hx:focus:outline-none hx:focus:ring-2 hx:focus:ring-blue-500 hx:focus:ring-offset-2"
        data-default-text="最大化内容宽度"
        data-active-text="恢复默认宽度"
        aria-label="最大化内容宽度"
        aria-pressed="false"
        title="最大化内容宽度"
      >
        <span class="hx:sr-only" data-label>最大化内容宽度</span>
        <span data-icon-default>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hx:h-5 hx:w-5">
            <path d="M15 3h6v6" />
            <path d="m21 3-7 7" />
            <path d="m3 21 7-7" />
            <path d="M9 21H3v-6" />
          </svg>
        </span>
        <span data-icon-active class="hx:hidden">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hx:h-5 hx:w-5">
            <path d="m14 10 7-7" />
            <path d="M20 10h-6V4" />
            <path d="m3 21 7-7" />
            <path d="M4 14h6v6" />
          </svg>
        </span>
      </button>
    {{- end }}

    <button type="button" aria-label="Menu" class="hextra-hamburger-menu hx:cursor-pointer hx:-mr-2 hx:rounded-sm hx:p-2 hx:active:bg-gray-400/20 hx:md:hidden">
      {{- partial "utils/icon.html" (dict "name" "hamburger-menu" "attributes" (printf "height=%d" $iconHeight)) -}}
    </button>
  </nav>
</div>
